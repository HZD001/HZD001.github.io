const NotificationManager={permission:"default",lunchNotified:false,offWorkNotified:false,breakNotified:false,customReminderNotified:{},config:null,audioCache:{},async init(config){this.config=config;if("Notification" in window){this.permission=window.Notification.permission;if(this.permission==="default"){this.permission=await window.Notification.requestPermission();}}},_0x0(title,body,options={}){const _0x1=this.config?.notifyMethod||"all";if(_0x1==="all"||_0x1==="notification"){this._0x2(title,body,options);}if(_0x1==="all"||_0x1==="sound"){this.playSound();}if(_0x1==="all"||_0x1==="flash"){this._0x8();}if(_0x1==="vibrate"){this.vibrate();}},_0x2(title,body,options={}){if(this.permission==="granted"){if(window.location.protocol==="file:"){return;}const _0x3=options._0x3||5000;const requireInteraction=options.requireInteraction||false;try{const notification=new window.Notification(title,{body:body,icon:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%23667eea'/%3E%3Ctext x='50' y='65' font-size='50' text-anchor='middle' fill='white'%3E⏰%3C/text%3E%3C/svg%3E",badge:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='%23667eea'/%3E%3C/svg%3E",requireInteraction:requireInteraction,silent:false,tag:`countdown-${Date.now()}`,timestamp:Date.now(),});notification.onclick=()=>{window.focus();notification.close();};notification.onerror=()=>{};if(!requireInteraction){setTimeout(()=>{notification.close();},_0x3);}}catch(e){}}},playSound(){const soundType=this.config?.soundType||"beep";if(soundType==="custom"&&this.config?.customSoundUrl){this.playCustomSound(this.config.customSoundUrl);return;}this._0x4(soundType);},playCustomSound(base64Data){try{const audio=new Audio(base64Data);audio.volume=0.5;audio.play().catch((e)=> console.error("播放自定义音频失败:",e));}catch(e){console.error("加载自定义音频失败:",e);this._0x4("beep");}},_0x4(type){try{const _0x5=new(window.AudioContext||window.webkitAudioContext)();const oscillator=_0x5.createOscillator();const gainNode=_0x5.createGain();oscillator.connect(gainNode);gainNode.connect(_0x5.destination);const soundConfig=this.getSoundConfig(type);oscillator.frequency.value=soundConfig.frequency;oscillator.type=soundConfig.waveType;gainNode.gain.setValueAtTime(0.3,_0x5.currentTime);gainNode.gain.exponentialRampToValueAtTime(0.01,_0x5.currentTime + soundConfig.duration);oscillator.start(_0x5.currentTime);oscillator.stop(_0x5.currentTime + soundConfig.duration);if(soundConfig.repeat){setTimeout(()=>{const _0x6=_0x5.createOscillator();const _0x7=_0x5.createGain();_0x6.connect(_0x7);_0x7.connect(_0x5.destination);_0x6.frequency.value=soundConfig.frequency;_0x6.type=soundConfig.waveType;_0x7.gain.setValueAtTime(0.3,_0x5.currentTime);_0x7.gain.exponentialRampToValueAtTime(0.01,_0x5.currentTime + soundConfig.duration);_0x6.start(_0x5.currentTime);_0x6.stop(_0x5.currentTime + soundConfig.duration);},soundConfig.delay||300);}}catch(e){console.error("播放声音失败:",e);}},getSoundConfig(type){const configs={beep:{frequency:800,waveType:"sine",duration:0.5,repeat:true,delay:300,},bell:{frequency:1000,waveType:"triangle",duration:0.8,repeat:false,},chime:{frequency:1200,waveType:"sine",duration:0.6,repeat:true,delay:400,},ding:{frequency:1500,waveType:"square",duration:0.3,repeat:true,delay:200,},};return configs[type]||configs.beep;},_0x8(){const card=document.querySelector(".card");if(card){card.classList.add("flash-notification");setTimeout(()=>{card.classList.remove("flash-notification");},1500);}const originalTitle=document.title;let count=0;const interval=setInterval(()=>{document.title=count % 2===0?"⏰ 提醒！":originalTitle;count++;if(count > 10){clearInterval(interval);document.title=originalTitle;}},500);},vibrate(){if("vibrate" in navigator){navigator.vibrate([200,100,200,100,200]);}},speak(text){if("speechSynthesis" in window){const utterance=new SpeechSynthesisUtterance(text);utterance.lang="zh-CN";utterance.rate=1;utterance.pitch=1;utterance.volume=1;window.speechSynthesis.speak(utterance);}},notifyLunch(){if(!this.lunchNotified){this._0x0("午休时间到啦！","该休息一下了，好好享受午休时光吧~",{requireInteraction:true,});this.lunchNotified=true;}},notifyOffWork(){if(!this.offWorkNotified){this._0x0("下班时间到！","辛苦了一天，可以下班啦！",{requireInteraction:true,});this.offWorkNotified=true;}},notifyBreak(){if(!this.breakNotified){this._0x0("该休息一下啦！","已经工作一段时间了，起来走走、看看远方，放松一下眼睛和身体吧~",{_0x3:15000,});this.breakNotified=true;}},notifyCustomReminder(reminder){const _0x9=new Date().toISOString().split('T')[0];const _0xa=`${reminder.id}_${_0x9}`;if(!this.customReminderNotified[_0xa]){this._0x0(reminder.title,reminder.content||"定时提醒~",{_0x3:10000,});this.customReminderNotified[_0xa]=true;Config.markReminderNotified(reminder.id,_0x9);}},checkCustomReminders(reminders){if(!reminders||!Array.isArray(reminders))return;const now=new Date();const currentTime=`${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;const _0x9=now.toISOString().split('T')[0];reminders.forEach(reminder=>{if(!reminder.enabled)return;if(reminder.time===currentTime){if(!Config.isReminderNotified(reminder.id,_0x9)){this.notifyCustomReminder(reminder);}}});},reset(){this.lunchNotified=false;this.offWorkNotified=false;this.breakNotified=false;this.customReminderNotified={};},_0xb(){this.customReminderNotified={};},};